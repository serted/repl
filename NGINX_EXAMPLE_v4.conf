server {
  listen 80;
  server_name kaib.net;
  root /var/www/kaib.net;

  index index.php index.html;

  location = /dev { return 302 /dev/; }

  location ^~ /dev/ {
    alias /var/www/kaib.net/dev/;

    location ~* \.(?:css|js|mjs|png|jpg|jpeg|gif|svg|webp|ico|woff2?)$ {
      expires 30d;
      add_header Cache-Control "public, immutable";
      try_files $uri =404;
    }

    location ~* \.(?:sql|sh|log|ini|env|md)$ { deny all; }

    location ~ \.php$ {
      include fastcgi_params;
      fastcgi_param SCRIPT_FILENAME $request_filename;
      fastcgi_pass unix:/run/php/php8.3-fpm.sock;
      fastcgi_read_timeout 60s;
    }

    try_files $uri $uri/ /dev/index.php?$args;
  }

  gzip on;
  gzip_types text/css application/javascript application/json image/svg+xml;
}
